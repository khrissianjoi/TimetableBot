import requests
import json
import datetime
import dateutil.parser

# time = datetime.datetime.now().isoformat()
r = [{'CategoryTypeIdentity': '241e4d36-60e0-49f8-b27e-99416745d98d', 'CategoryTypeName': 'Programmes of Study', 'CategoryEvents': [{'EventIdentity': '76184ef2-f646-e402-9455-8b5abe2f5a44', 'HostKey': '1819#SPLUS4FB59B', 'Description': 'Operating Systems', 'EndDateTime': '2019-02-06T14:00:00+00:00', 'EventType': 'Lecture', 'IsPublished': True, 'Location': 'GLA.HG20', 'Owner': 'b8cf1f5a-9687-4440-86b8-13da2c69fa62', 'StartDateTime': '2019-02-06T13:00:00+00:00', 'IsDeleted': False, 'LastModified': '2019-02-08T10:46:35.6014444+00:00', 'ExtraProperties': [{'Name': 'Module Name', 'DisplayName': 'Module Name', 'Value': 'CA216[2] Operating Systems', 'Rank': 1}, {'Name': 'Activity.TeachingWeekPattern_PatternAsArray', 'DisplayName': 'Weeks', 'Value': '19-30', 'Rank': 3}], 'UserManuallyAddedEvent': False, 'StatusIdentity': 'b48c85d4-19aa-4b19-87a6-63a5c6d2e630', 'Status': None, 'StatusBackgroundColor': None, 'Name': 'CA216(2)L1', 'Identity': 'ac8bd702-0bc6-4359-bd09-ac46e0ce7ca7'}, {'EventIdentity': '2a771d55-2979-d60d-858b-e1747524cc19', 'HostKey': '1819#SPLUS53F6DE', 'Description': 'Operating Systems', 'EndDateTime': '2019-02-07T17:00:00+00:00', 'EventType': 'Lecture', 'IsPublished': True, 'Location': 'GLA.XG19', 'Owner': 'b8cf1f5a-9687-4440-86b8-13da2c69fa62', 'StartDateTime': '2019-02-07T16:00:00+00:00', 'IsDeleted': False, 'LastModified': '2018-12-19T14:32:06.0781597+00:00', 'ExtraProperties': [{'Name': 'Module Name', 'DisplayName': 'Module Name', 'Value': 'CA216[2] Operating Systems', 'Rank': 1}, {'Name': 'Activity.TeachingWeekPattern_PatternAsArray', 'DisplayName': 'Weeks', 'Value': '19-30', 'Rank': 3}], 'UserManuallyAddedEvent': False, 'StatusIdentity': 'b48c85d4-19aa-4b19-87a6-63a5c6d2e630', 'Status': None, 'StatusBackgroundColor': None, 'Name': 'CA216(2)L2', 'Identity': 'e00d45f7-b98f-4ec8-a91a-401a65d348c1'}, {'EventIdentity': '6f36ab50-1e01-4612-e83f-adfe5accd3e4', 'HostKey': '1819#SPLUSB4F74C', 'Description': 'Operating Systems', 'EndDateTime': '2019-02-08T12:00:00+00:00', 'EventType': 'Practical', 'IsPublished': True, 'Location': 'GLA.L101, GLA.LG27', 'Owner': 'b8cf1f5a-9687-4440-86b8-13da2c69fa62', 'StartDateTime': '2019-02-08T10:00:00+00:00', 'IsDeleted': False, 'LastModified': '2018-12-19T14:32:07.3752225+00:00', 'ExtraProperties': [{'Name': 'Module Name', 'DisplayName': 'Module Name', 'Value': 'CA216[2] Operating Systems', 'Rank': 1}, {'Name': 'Activity.TeachingWeekPattern_PatternAsArray', 'DisplayName': 'Weeks', 'Value': '20-21', 'Rank': 3}], 'UserManuallyAddedEvent': False, 'StatusIdentity': 'b48c85d4-19aa-4b19-87a6-63a5c6d2e630', 'Status': None, 'StatusBackgroundColor': None, 'Name': 'CA216[2]P1', 'Identity': '0be39a40-cb69-46c6-bd85-12b959c19f06'}, {'EventIdentity': '80755f6c-93d8-7c41-1dbd-50d9e053b122', 'HostKey': '1819#SPLUS641D9B', 'Description': 'Advanced Computer Architectures', 'EndDateTime': '2019-02-06T12:00:00+00:00', 'EventType': 'Lecture', 'IsPublished': True, 'Location': 'GLA.XG19', 'Owner': 'b8cf1f5a-9687-4440-86b8-13da2c69fa62', 'StartDateTime': '2019-02-06T11:00:00+00:00', 'IsDeleted': False, 'LastModified': '2018-11-02T16:07:49.1333148+00:00', 'ExtraProperties': [{'Name': 'Module Name', 'DisplayName': 'Module Name', 'Value': 'CA226[2] Advanced Computer Architectures', 'Rank': 1}, {'Name': 'Activity.TeachingWeekPattern_PatternAsArray', 'DisplayName': 'Weeks', 'Value': '19-30', 'Rank': 3}], 'UserManuallyAddedEvent': False, 'StatusIdentity': 'b48c85d4-19aa-4b19-87a6-63a5c6d2e630', 'Status': None, 'StatusBackgroundColor': None, 'Name': 'CA226[2]L1', 'Identity': '36b70907-ed36-47b7-a436-de662a0eb181'}, {'EventIdentity': 'da92ba05-1fa7-9df8-eeef-d11a165b91ea', 'HostKey': '1819#SPLUS641D9D', 'Description': 'Advanced Computer Architectures', 'EndDateTime': '2019-02-07T11:00:00+00:00', 'EventType': 'Lecture', 'IsPublished': True, 'Location': 'GLA.XG22', 'Owner': 'b8cf1f5a-9687-4440-86b8-13da2c69fa62', 'StartDateTime': '2019-02-07T10:00:00+00:00', 'IsDeleted': False, 'LastModified': '2018-11-02T16:07:47.430139+00:00', 'ExtraProperties': [{'Name': 'Module Name', 'DisplayName': 'Module Name', 'Value': 'CA226[2] Advanced Computer Architectures', 'Rank': 1}, {'Name': 'Activity.TeachingWeekPattern_PatternAsArray', 'DisplayName': 'Weeks', 'Value': '19-30', 'Rank': 3}], 'UserManuallyAddedEvent': False, 'StatusIdentity': 'b48c85d4-19aa-4b19-87a6-63a5c6d2e630', 'Status': None, 'StatusBackgroundColor': None, 'Name': 'CA226[2]L2', 'Identity': 'a38d9269-8d0d-4bf5-bb97-ebb06b2a7908'}, {'EventIdentity': 'a3ab35cf-aa53-2a25-ba80-30313a19f78c', 'HostKey': '1819#SPLUSBC844E', 'Description': 'Advanced Computer Architectures', 'EndDateTime': '2019-02-06T13:00:00+00:00', 'EventType': 'Practical', 'IsPublished': True, 'Location': 'GLA.L128, GLA.L101', 'Owner': 'b8cf1f5a-9687-4440-86b8-13da2c69fa62', 'StartDateTime': '2019-02-06T12:00:00+00:00', 'IsDeleted': False, 'LastModified': '2018-12-13T14:59:13.7948819+00:00', 'ExtraProperties': [{'Name': 'Module Name', 'DisplayName': 'Module Name', 'Value': 'CA226[2] Advanced Computer Architectures', 'Rank': 1}, {'Name': 'Activity.TeachingWeekPattern_PatternAsArray', 'DisplayName': 'Weeks', 'Value': '19-30', 'Rank': 3}], 'UserManuallyAddedEvent': False, 'StatusIdentity': 'b48c85d4-19aa-4b19-87a6-63a5c6d2e630', 'Status': None, 'StatusBackgroundColor': None, 'Name': 'CA226[2]P1', 'Identity': 'dbda5558-c9ec-4909-9bd2-ee2ff1aac880'}, {'EventIdentity': '3e557204-af79-fd40-283a-821657740afa', 'HostKey': '1819#SPLUS4E0F30', 'Description': 'Probability & Statistics', 'EndDateTime': '2019-02-07T12:00:00+00:00', 'EventType': 'Lecture', 'IsPublished': True, 'Location': 'GLA.XG22', 'Owner': 'b8cf1f5a-9687-4440-86b8-13da2c69fa62', 'StartDateTime': '2019-02-07T11:00:00+00:00', 'IsDeleted': False, 'LastModified': '2018-11-02T16:07:47.117034+00:00', 'ExtraProperties': [{'Name': 'Module Name', 'DisplayName': 'Module Name', 'Value': 'CA266[2] Probability & Statistics', 'Rank': 1}, {'Name': 'Activity.TeachingWeekPattern_PatternAsArray', 'DisplayName': 'Weeks', 'Value': '19-30', 'Rank': 3}], 'UserManuallyAddedEvent': False, 'StatusIdentity': 'b48c85d4-19aa-4b19-87a6-63a5c6d2e630', 'Status': None, 'StatusBackgroundColor': None, 'Name': 'CA266[2] L1', 'Identity': '3f3d9726-c8df-431b-8b93-213986b9621a'}, {'EventIdentity': 'eec1b20c-3686-d7cd-2adb-4f22f22acaf1', 'HostKey': '1819#SPLUS4E0F32', 'Description': 'Probability & Statistics', 'EndDateTime': '2019-02-07T13:00:00+00:00', 'EventType': 'Lecture', 'IsPublished': True, 'Location': 'GLA.L101', 'Owner': 'b8cf1f5a-9687-4440-86b8-13da2c69fa62', 'StartDateTime': '2019-02-07T12:00:00+00:00', 'IsDeleted': False, 'LastModified': '2019-01-03T11:44:12.7325966+00:00', 'ExtraProperties': [{'Name': 'Module Name', 'DisplayName': 'Module Name', 'Value': 'CA266[2] Probability & Statistics', 'Rank': 1}, {'Name': 'Activity.TeachingWeekPattern_PatternAsArray', 'DisplayName': 'Weeks', 'Value': '19-30', 'Rank': 3}], 'UserManuallyAddedEvent': False, 'StatusIdentity': 'b48c85d4-19aa-4b19-87a6-63a5c6d2e630', 'Status': None, 'StatusBackgroundColor': None, 'Name': 'CA266[2] L2', 'Identity': 'cf9dc9fa-9cbe-427c-b5ae-f22472870216'}, {'EventIdentity': 'daa1bff4-0efd-b989-d26f-128089f3c3e8', 'HostKey': '1819#SPLUSCBCFC4', 'Description': 'Probability & Statistics', 'EndDateTime': '2019-02-04T13:00:00+00:00', 'EventType': 'Practical', 'IsPublished': True, 'Location': 'GLA.LG27, GLA.LG26, GLA.LG25', 'Owner': 'b8cf1f5a-9687-4440-86b8-13da2c69fa62', 'StartDateTime': '2019-02-04T12:00:00+00:00', 'IsDeleted': False, 'LastModified': '2018-12-13T14:59:42.5471957+00:00', 'ExtraProperties': [{'Name': 'Module Name', 'DisplayName': 'Module Name', 'Value': 'CA266[2] Probability & Statistics', 'Rank': 1}, {'Name': 'Activity.TeachingWeekPattern_PatternAsArray', 'DisplayName': 'Weeks', 'Value': '20-30', 'Rank': 3}], 'UserManuallyAddedEvent': False, 'StatusIdentity': 'b48c85d4-19aa-4b19-87a6-63a5c6d2e630', 'Status': None, 'StatusBackgroundColor': None, 'Name': 'CA266[2] P1', 'Identity': '9bc7d26e-31c8-48c8-8395-a55094513af1'}, {'EventIdentity': 'f448d04f-3b8b-d784-228b-cd18091b9acc', 'HostKey': '1819#SPLUS56136E', 'Description': 'Software Testing', 'EndDateTime': '2019-02-05T13:00:00+00:00', 'EventType': 'Lecture', 'IsPublished': True, 'Location': 'GLA.CG12', 'Owner': 'b8cf1f5a-9687-4440-86b8-13da2c69fa62', 'StartDateTime': '2019-02-05T12:00:00+00:00', 'IsDeleted': False, 'LastModified': '2019-01-22T09:56:31.750513+00:00', 'ExtraProperties': [{'Name': 'Module Name', 'DisplayName': 'Module Name', 'Value': 'CA267[2] Software Testing', 'Rank': 1}, {'Name': 'Activity.TeachingWeekPattern_PatternAsArray', 'DisplayName': 'Weeks', 'Value': '19-20, 24-30', 'Rank': 3}], 'UserManuallyAddedEvent': False, 'StatusIdentity': 'b48c85d4-19aa-4b19-87a6-63a5c6d2e630', 'Status': None, 'StatusBackgroundColor': None, 'Name': 'CA267[2] L1', 'Identity': '25ba226d-72ef-463f-9735-23582deb0e09'}, {'EventIdentity': 'b5167634-9bb7-a7b6-6cb9-17322979ed77', 'HostKey': '1819#SPLUS56136C', 'Description': 'Software Testing', 'EndDateTime': '2019-02-05T14:00:00+00:00', 'EventType': 'Lecture', 'IsPublished': True, 'Location': 'GLA.CG12', 'Owner': 'b8cf1f5a-9687-4440-86b8-13da2c69fa62', 'StartDateTime': '2019-02-05T13:00:00+00:00', 'IsDeleted': False, 'LastModified': '2019-01-22T09:56:32.2036501+00:00', 'ExtraProperties': [{'Name': 'Module Name', 'DisplayName': 'Module Name', 'Value': 'CA267[2] Software Testing', 'Rank': 1}, {'Name': 'Activity.TeachingWeekPattern_PatternAsArray', 'DisplayName': 'Weeks', 'Value': '19-20, 24-30', 'Rank': 3}], 'UserManuallyAddedEvent': False, 'StatusIdentity': 'b48c85d4-19aa-4b19-87a6-63a5c6d2e630', 'Status': None, 'StatusBackgroundColor': None, 'Name': 'CA267[2] L1', 'Identity': 'e8d8272e-4e10-4b1c-92c1-1039b792dcf6'}, {'EventIdentity': 'fc344768-c1f1-82fa-2fca-15f7a1ccd83a', 'HostKey': '1819#SPLUS338B18', 'Description': 'Computer Programming 4 (Object Orientated Programming)', 'EndDateTime': '2019-02-04T15:00:00+00:00', 'EventType': 'Lecture', 'IsPublished': True, 'Location': 'GLA.QG13', 'Owner': 'b8cf1f5a-9687-4440-86b8-13da2c69fa62', 'StartDateTime': '2019-02-04T14:00:00+00:00', 'IsDeleted': False, 'LastModified': '2018-11-02T16:07:50.1730094+00:00', 'ExtraProperties': [{'Name': 'Module Name', 'DisplayName': 'Module Name', 'Value': 'CA269[2] Computer Programming 4 (Object Orientated Programming)', 'Rank': 1}, {'Name': 'Activity.TeachingWeekPattern_PatternAsArray', 'DisplayName': 'Weeks', 'Value': '19-30', 'Rank': 3}], 'UserManuallyAddedEvent': False, 'StatusIdentity': 'b48c85d4-19aa-4b19-87a6-63a5c6d2e630', 'Status': None, 'StatusBackgroundColor': None, 'Name': 'CA269(2) L1', 'Identity': '20677dd4-eaa4-4ac4-8322-cf2bb8c1b4f7'}, {'EventIdentity': '351521a1-0866-357a-24ee-a55d9649f4c8', 'HostKey': '1819#SPLUSDCCAE7', 'Description': 'Computer Programming 4 (Object Orientated Programming)', 'EndDateTime': '2019-02-04T16:00:00+00:00', 'EventType': 'Lecture', 'IsPublished': True, 'Location': 'GLA.XG21', 'Owner': 'b8cf1f5a-9687-4440-86b8-13da2c69fa62', 'StartDateTime': '2019-02-04T15:00:00+00:00', 'IsDeleted': False, 'LastModified': '2018-11-02T16:07:46.1671363+00:00', 'ExtraProperties': [{'Name': 'Module Name', 'DisplayName': 'Module Name', 'Value': 'CA269[2] Computer Programming 4 (Object Orientated Programming)', 'Rank': 1}, {'Name': 'Activity.TeachingWeekPattern_PatternAsArray', 'DisplayName': 'Weeks', 'Value': '19-30', 'Rank': 3}], 'UserManuallyAddedEvent': False, 'StatusIdentity': 'b48c85d4-19aa-4b19-87a6-63a5c6d2e630', 'Status': None, 'StatusBackgroundColor': None, 'Name': 'CA269(2) L2', 'Identity': '2519aecf-20aa-4a2b-8316-72188243e93a'}, {'EventIdentity': '938152bc-51c1-7af7-28e6-5bd41753997c', 'HostKey': '1819#SPLUSDCCAE9', 'Description': 'Computer Programming 4 (Object Orientated Programming)', 'EndDateTime': '2019-02-04T18:00:00+00:00', 'EventType': 'Practical', 'IsPublished': True, 'Location': 'GLA.L125, GLA.LG26, GLA.LG25', 'Owner': 'b8cf1f5a-9687-4440-86b8-13da2c69fa62', 'StartDateTime': '2019-02-04T16:00:00+00:00', 'IsDeleted': False, 'LastModified': '2019-02-26T14:45:24.0522188+00:00', 'ExtraProperties': [{'Name': 'Module Name', 'DisplayName': 'Module Name', 'Value': 'CA269[2] Computer Programming 4 (Object Orientated Programming)', 'Rank': 1}, {'Name': 'Activity.TeachingWeekPattern_PatternAsArray', 'DisplayName': 'Weeks', 'Value': '19-30', 'Rank': 3}], 'UserManuallyAddedEvent': False, 'StatusIdentity': 'b48c85d4-19aa-4b19-87a6-63a5c6d2e630', 'Status': None, 'StatusBackgroundColor': None, 'Name': 'CA269(2) P1', 'Identity': '9d81c4ac-7a99-4fa2-832f-fefecf3f19ba'}, {'EventIdentity': 'a0fc915e-27da-70bb-056a-67b7c5d78b18', 'HostKey': '1819#SPLUS621094', 'Description': None, 'EndDateTime': '2019-02-05T18:00:00+00:00', 'EventType': 'Lecture', 'IsPublished': True, 'Location': 'GLA.SA101', 'Owner': 'b8cf1f5a-9687-4440-86b8-13da2c69fa62', 'StartDateTime': '2019-02-05T17:00:00+00:00', 'IsDeleted': False, 'LastModified': '2019-01-24T10:11:02.3300752+00:00', 'ExtraProperties': [{'Name': 'Module Name', 'DisplayName': 'Module Name', 'Value': 'MS200[2] Linear Algebra, MS200A[2]Linear Algebra', 'Rank': 1}, {'Name': 'Activity.TeachingWeekPattern_PatternAsArray', 'DisplayName': 'Weeks', 'Value': '19-30', 'Rank': 3}], 'UserManuallyAddedEvent': False, 'StatusIdentity': 'b48c85d4-19aa-4b19-87a6-63a5c6d2e630', 'Status': None, 'StatusBackgroundColor': None, 'Name': 'MS200/A/B[2]L2/01', 'Identity': 'e6e364f2-38d4-48d4-b5c0-881b16a892aa'}, {'EventIdentity': '54f88b83-471d-b6f7-02fb-d519af3f6b53', 'HostKey': '1819#SPLUS62107D', 'Description': 'Linear Algebra', 'EndDateTime': '2019-02-08T10:00:00+00:00', 'EventType': 'Lecture', 'IsPublished': True, 'Location': 'GLA.SA101', 'Owner': 'b8cf1f5a-9687-4440-86b8-13da2c69fa62', 'StartDateTime': '2019-02-08T09:00:00+00:00', 'IsDeleted': False, 'LastModified': '2019-01-14T12:56:54.5582822+00:00', 'ExtraProperties': [{'Name': 'Module Name', 'DisplayName': 'Module Name', 'Value': 'MS200[2] Linear Algebra, MS200A[2]Linear Algebra', 'Rank': 1}, {'Name': 'Activity.TeachingWeekPattern_PatternAsArray', 'DisplayName': 'Weeks', 'Value': '19-30', 'Rank': 3}], 'UserManuallyAddedEvent': False, 'StatusIdentity': 'b48c85d4-19aa-4b19-87a6-63a5c6d2e630', 'Status': None, 'StatusBackgroundColor': None, 'Name': 'MS200/A[2]L1/01', 'Identity': '4a0f362c-92cd-4086-a066-9b4f8373ecb3'}, {'EventIdentity': '53c62b14-96fe-20b7-1bff-39e49a73d34d', 'HostKey': '1819#SPLUS71282E', 'Description': 'Linear Algebra', 'EndDateTime': '2019-02-05T17:00:00+00:00', 'EventType': 'Tutorial', 'IsPublished': True, 'Location': 'GLA.XG14', 'Owner': 'b8cf1f5a-9687-4440-86b8-13da2c69fa62', 'StartDateTime': '2019-02-05T16:00:00+00:00', 'IsDeleted': False, 'LastModified': '2019-01-22T12:18:10.2335006+00:00', 'ExtraProperties': [{'Name': 'Module Name', 'DisplayName': 'Module Name', 'Value': 'MS200[2] Linear Algebra', 'Rank': 1}, {'Name': 'Activity.TeachingWeekPattern_PatternAsArray', 'DisplayName': 'Weeks', 'Value': '20-30', 'Rank': 3}], 'UserManuallyAddedEvent': False, 'StatusIdentity': 'b48c85d4-19aa-4b19-87a6-63a5c6d2e630', 'Status': None, 'StatusBackgroundColor': None, 'Name': 'MS200[2]T1 CASE (A-L)', 'Identity': 'f2ace587-6428-427d-b154-0681dd7e165d'}, {'EventIdentity': 'a74197a8-3244-c9c7-b308-7645ee87474b', 'HostKey': '1819#SPLUS7A933B', 'Description': 'Linear Algebra', 'EndDateTime': '2019-02-05T16:00:00+00:00', 'EventType': 'Tutorial', 'IsPublished': True, 'Location': 'GLA.C115', 'Owner': 'b8cf1f5a-9687-4440-86b8-13da2c69fa62', 'StartDateTime': '2019-02-05T15:00:00+00:00', 'IsDeleted': False, 'LastModified': '2019-01-22T12:18:21.9278092+00:00', 'ExtraProperties': [{'Name': 'Module Name', 'DisplayName': 'Module Name', 'Value': 'MS200[2] Linear Algebra', 'Rank': 1}, {'Name': 'Activity.TeachingWeekPattern_PatternAsArray', 'DisplayName': 'Weeks', 'Value': '20-30', 'Rank': 3}], 'UserManuallyAddedEvent': False, 'StatusIdentity': 'b48c85d4-19aa-4b19-87a6-63a5c6d2e630', 'Status': None, 'StatusBackgroundColor': None, 'Name': 'MS200[2]T1 CASE (M-Z)', 'Identity': 'e5f206d2-139b-499d-8f5f-c07e019662a1'}], 'Name': 'CASE2', 'Identity': '38b55ac0-a242-23d3-4a10-79f11bdd780c'}]
my_time = "2019-02-04T13:30:00.000Z"
current = {
  "ViewOptions": {
    "Weeks": [
      {
        "FirstDayInWeek": my_time
      }
    ]
  },
  "CategoryIdentities": [
    "38b55ac0-a242-23d3-4a10-79f11bdd780c"
  ]
}
headers = {
    'Content-Type': 'application/json',
    'Authorization': 'basic T64Mdy7m['
}

link = 'https://opentimetable.dcu.ie/broker/api/categoryTypes/241e4d36-60e0-49f8-b27e-99416745d98d/categories/events/filter'


time_module = {}

# r = requests.post(link, json=current, headers=headers)
# print(r[0]['CategoryEvents'])

for module in r[0]['CategoryEvents']:
    startdate = dateutil.parser.parse(module["StartDateTime"])
    enddate = dateutil.parser.parse(module["EndDateTime"])
    time_module[startdate,enddate] = module["Description"]

print(time_module)
# min(dates, key=lambda x: abs(x - target))=
# print(time_module[min(time_module.keys(), key=lambda x: abs(x - dateutil.parser.parse(my_time)))])